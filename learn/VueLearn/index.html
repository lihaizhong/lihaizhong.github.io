<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Vue 2.x 学习</title>
    <script src="vue.js"></script>
  </head>
  <body>
    <div id="app"></div>

    <script>
      ;(function() {
        const mixin = {
          data() {
            return {
              message: 'hello vue mixin',
              value: 'mixin value',
              arr: [3, 4, 5, 6],
              obj1: { a: 5, b: 6, c: 7, d: 8 }
            }
          }
        }

        const mixin1 = {
          data() {
            return {
              message: 'hello vue mixin1',
              value: 'mixin value1',
              arr: [7, 8, 9],
              obj1: { b: 9, c: 7, d: 10, e: 78 }
            }
          }
        }

        Vue.mixin({})

        Vue.component('ds-render-template', {
          render(h, context) {
            return h('div', context.data, [
              h('template', 'hello render function')
            ])
          }
        })

        Vue.component('ds-simple-template', {
          template: `
            <div>
              <p>{{ message }}</p>
              <p>{{ pValue }}</p>
              <p>{{ pValue1 }}</p>
            </div>
          `,
          inject: ['pValue', 'pValue1'],
          data() {
            return {
              message: 'hello simple template'
            }
          },
          created() {
            console.log('second vm: ', this)
          }
        })

        Vue.component('ds-template', {
          template: `
            <div>
              <p>{{ message }}</p>
              <ds-simple-template></ds-simple-template>
              <p>{{ com }}</p>
              <p>{{ count }}</p>
              <button @click="onHandleAddCount">{{ outer }}</button>
            </div>`,
          provide: function() {
            return {
              pValue: 'provide template value'
            }
          },
          props: {
            outer: {
              type: String,
              default: 'outer'
            }
          },
          data() {
            return {
              message: 'ds-template',
              count: 0
            }
          },
          computed: {
            com() {
              return 'dddd'
            }
          },
          methods: {
            onHandleAddCount() {
              this.count++
            }
          },
          created() {
            console.log('first vm: ', this)
          }
        })

        const DsInternalTemplate = Vue.extend({
          template: `
            <keep-alive>
              <div>{{ message }}</div>
            </keep-alive>`,
          data() {
            return {
              message: 'ds internal template'
            }
          }
        })

        const app = new Vue({
          el: '#app',
          provide: function() {
            return {
              pValue: 'provide value',
              pValue1: 'provide root value'
            }
          },
          components: {
            DsInternalTemplate: DsInternalTemplate
          },
          template: `
            <div>
              <p>{{ message }}</p>
              <div><input v-model="value" /></div>
              <ds-template outer="计数器" />
              <ds-internal-template />
            </div>
            `,
          mixins: [mixin, mixin1],
          data() {
            return {
              message: 'hello vue',
              value: 'hello input',
              arr: [1, 2, 4, 6],
              object: {
                a: 1,
                b: 2,
                c: 3
              }
            }
          },
          watch: {
            message() {
              console.log('$data __ob__: ', this.$data.__ob__)
            },
            object: {
              deep: true,
              handler() {
                console.log('object __ob__: ', this.object.__ob__)
              }
            },
            arr: {
              immediate: true,
              handler() {
                console.log('arr __ob__', this.arr.__ob__)
              }
            }
          },
          mounted() {
            const slf = this
            setTimeout(function() {
              // slf.arr.push(5)
              slf.object.a = 9
              slf.message = '更新消息'
              // 设置未在$data上预设的属性会报错
              // [Vue warn]: Avoid adding reactive properties to a Vue instance or its root $data at runtime - declare it upfront in the data option.
              // slf.$set(slf.$data, 'd', 4)
              // 删除$data上面的属性会报错
              // [Vue warn]: Avoid deleting properties on a Vue instance or its root $data - just set it to null.
              // slf.$delete(slf.$data, 'a')
            }, 1000)
          }
        })

        console.log('app: ', app)
      })()
    </script>
  </body>
</html>
